<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    
    <head>
   <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-106786912-1">
    </script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments)};
      gtag('js', new Date());
      gtag('config', 'UA-106786912-1');
    </script>


     <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 <!--
      loads the http over https ssl -
      welcome to my website!

	this theme is based off the Ice & Fire theme created by Lucas Gatsas
      https://www.twitter.com/LucasGatsas
      www.lucasgatsas.ch - switzerland.
  -->


<!-- Microsoft Internet Explorer documentMode compatMode setting IE Modus -->
<script type="text/javascript">
var IE = null;
if (window.navigator.appName == "Microsoft Internet Explorer") {
  if (document.documentMode) {

    IE = document.documentMode;
    } else {

        IE = 5;
          if (document.compatMode) {
      if (document.compatMode == "CSS1Compat")
      IE = 11;
      }
    }
  }
</script>

    <meta charset="utf-8">
    <!-- X-UA -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <link rel="author" title="Ranjit Jhala" href="http://ranjitjhala.github.io" />

    <meta name="google" content="notranslate" />
    <!-- Viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- index ROBOTS follow -->
    <meta name="robots" content="index, follow" />
    <!-- Site Desciption -->
    <meta name="description" content="LiquidHaskell Blog">
    <!-- Site Desciption -->
    <meta name="keywords" content="haskell, refinement types, liquid types, formal methods, type systems">
    <!-- Favicon -->
    <link rel="shortcut icon" href="https://ucsd-progsys.github.io/liquidhaskell-blog/static/img/ico.png" type="image/x-icon" />
    <!-- Blog Title -->
    <title>LiquidHaskell</title>

    <!--     <title>{% if page.title %}{{ page.title }} - {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
-->
    <!-- Property Metas -->
    <meta property="og:image" content="https://ucsd-progsys.github.io/liquidhaskell-blog/static/img/ix.png" />
    <meta property="og:title" content="LiquidHaskell Blog" />
    <meta property="og:site_name" content="LiquidHaskell Blog" />
    <!-- Canonical -->
    <link rel="canonical" href="{{ page.url | replace:'index.html','' | prepend: site.baseUrl | prepend: site.url }}">
    <!-- StyleSheet -->
    <link rel="stylesheet" href="https://ucsd-progsys.github.io/liquidhaskell-blog/static/css/bootstrap.min.css">
    <!-- <link rel="stylesheet" href="https://ucsd-progsys.github.io/liquidhaskell-blog/static/css/spaceg.stylesheets.css"> -->
    <link rel="stylesheet" href="https://ucsd-progsys.github.io/liquidhaskell-blog/static/css/ronacher.css" type="text/css">

    <link rel="stylesheet" href="https://ucsd-progsys.github.io/liquidhaskell-blog/static/css/syntax.css">
    <link rel="stylesheet" href="https://ucsd-progsys.github.io/liquidhaskell-blog/static/css/liquid-light.css">

    <!-- Fonts
    <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Playfair+Display:400,700,900,400italic,700italic,900italic' rel='stylesheet' type='text/css'>
    -->

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
	#preloader {position:fixed;top:0;left:0;right:0;bottom:0;background-color:#fff; /* change if the mask should have another color then white */z-index:99; /* makes sure it stays on top */}
	#status {width:200px;height:200px;position:absolute;left:50%; /* centers the loading animation horizontally one the screen */top:50%; /* centers the loading animation vertically one the screen */background-image:url("/static/img/preloader.gif"); /* path to your loading animation */background-repeat:no-repeat;background-position:center;margin:-100px 0 0 -100px; /* is width and height divided by two */}
	ul, ol {margin-top: 0;margin-bottom: 10px;}
	.navbar-inverse {background-color: #FFF;border-color: #FFFFFF;}
</style>
<!--link rel="stylesheet" href="https://ucsd-progsys.github.io/liquidhaskell-blog/static/css/prettify.css"-->
<style>
  /* HEADER IMAGE */
  header.intro-header {background: #6f5499;background: no-repeat center center;background-attachment: scroll;-webkit-background-size: cover;-moz-background-size: cover;background-size: cover;-o-background-size: cover;}

	/* Preloader */#preloader {position:fixed;top:0;left:0;right:0;bottom:0;background-color:#fff; /* change if the mask should have another color then white */z-index:99; /* makes sure it stays on top */}
	#status {width:200px;height:200px;position:absolute;left:50%; /* centers the loading animation horizontally one the screen */top:50%; /* centers the loading animation vertically one the screen */background-image:; /* path to your loading animation */background-repeat:no-repeat;background-position:center;margin:-100px 0 0 -100px; /* is width and height divided by two */}
	li {list-style: none;}
            body.modal-open
            {overflow: hidden;padding-right: 0px;
        }
	article li {list-style: inherit;}
	article .figure {text-align: center}
    </style>
    <!-- end Loading front stylesheet here -->

    <link href="atom.xml" type="application/atom+xml" rel="alternate" title="LiquidHaskell-Blog ATOM Feed" />
    </head>

    <body>
	    
	<!-- 	
        <div id="preloader">
	    <div id="status">
	    </div>
	</div>  
	-->
	<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ucsd-progsys.github.io/liquidhaskell-blog" id="blog-title-left-top">LiquidHaskell</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- <li class="dropdown">
                    <a href="#portfolioModal2" data-toggle="modal"><i class="fa fa-random" id="icon-top"></i></a>
                <ul class="dropdown-menu"></ul>
                </li>-->
                
                <li><a href="https://ucsd-progsys.github.io/liquidhaskell-blog/blog.html">Blog</a></li>
                <li><a href="http://goto.ucsd.edu:8090/index.html#?demo=Csv.hs" target="_blank">Demo</a></li>
                <li><a href="http://ucsd-progsys.github.io/lh-workshop" target="_blank">Tutorial</a></li>
                <li><a href="http://ucsd-progsys.github.io/liquidhaskell-tutorial" target="_blank">Book</a></li>
                <li><a href="https://ucsd-progsys.github.io/liquidhaskell-blog/about.html" target="_blank">About</a></li>
                <li><a href="http://www.github.com/ucsd-progsys/liquidhaskell" target="_blank"><i class="fa fa-twitter"></i>Download</a></li>
                <!--
                <li><a href="https://www.twitter.com/ranjitjhala" id="roundbutton" target="_blank"><i class="fa fa-twitter"></i>RanjitJhala</a></li>
                -->
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<!-- Portfolio Modals -->
    <div class="portfolio-modal modal fade" id="portfolioModal1" tabindex="-1" role="dialog" aria-hidden="true" style="padding-right:0px; overflow: hidden;">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h1 class="font-style-inline-small-h1">Ranjit Jhala</h1>
                            <hr class="star-primary">
                            <img src="https://ucsd-progsys.github.io/liquidhaskell-blog/static/img/ico.png" class="img-responsive img-centered" alt title>
                            <p class="font-style-inline-small">
                                <a href="https://www.twitter.com/ranjitjhala" target="_blank">follow me</a>. <br>
                                <a href="https://www.github.com/ucsd-progsys" target="_blank">    <i class="fa fa-github" id="spaceg-social-modal"></i> </a>
                                <a href="https://www.twitter.com/ranjitjhala" target="_blank"><i class="fa fa-twitter" id="spaceg-social-modal"></i> </a>
                                <a href="https://plus.google.com/u/0/106612421534244742464" target="_blank"> <i class="fa fa-google-plus" id="spaceg-social-modal"></i></a>
                            </p>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- Menu Modals Add New Sa.21.Feb.2015 03:22:25 -->
    <div class="portfolio-modal modal fade" id="portfolioModal2" tabindex="-1" role="dialog" aria-hidden="true" style="padding-right:0px; overflow: hidden;">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h1 class="font-style-inline-small-h1">Ranjit Jhala</h1>
                            <hr class="star-primary">
                            <p class="font-style-inline-small">
                        <a href="https://www.twitter.com/ranjitjhala" target="_blank">follow</a>. <br>
                        <a href="https://www.github.com/ucsd-progsys" target="_blank">    <i class="fa fa-github" id="spaceg-social-modal"></i> </a>
                        <a href="https://www.twitter.com/ranjitjhala" target="_blank"><i class="fa fa-twitter" id="spaceg-social-modal"></i> </a>
                        <a href="https://plus.google.com/u/0/106612421534244742464" target="_blank"> <i class="fa fa-google-plus" id="spaceg-social-modal"></i></a>  <br>
                    <li><a href="https://ucsd-progsys.github.io/liquidhaskell-blog/index.html">Home</a></li>
                    <li><a href="https://ucsd-progsys.github.io/liquidhaskell-blog/about.html">About</a></li>
                    <li><a href="https://ucsd-progsys.github.io/liquidhaskell-blog/blog.html">Blog</a></li>
                    <li><a href="http://goto.ucsd.edu:8090/index.html#?demo=Csv.hs" target="_blank">Demo</a></li>
                    <li><a href="http://ucsd-progsys.github.io/lh-workshop" target="_blank">Tutorial</a></li>
                    <li><a href="http://ucsd-progsys.github.io/liquidhaskell-tutorial" target="_blank">Book</a></li>
                    <li><a href="http://www.github.com/ucsd-progsys/liquidhaskell" target="_blank"><i class="fa fa-twitter"></i>Download</a></li>
                            </p>

                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


        <div id="content">
            <!-- Post Header -->
<header class="intro-header" style="background-image: url('https://ucsd-progsys.github.io/liquidhaskell-blog/static/img/sea.jpg')" alt title>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>CSV Tables</h1>
                    
                    <span class="meta">
		    
			Posted by Ranjit Jhala
		    
			Oct 10, 2013
		    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

            <br>

            <div class="info">
              
                Tags: <a title="All pages tagged 'measures'." href="../../../../tags/measures.html">measures</a>
              
            </div>

            <br>
			            <p>Most demonstrations for verification techniques involve programs with complicated
invariants and properties. However, these methods can often be rather useful for
describing simple but important aspects of APIs or programs with more humble
goals. I saw a rather <a href="http://www.reddit.com/r/scala/comments/1nhzi2/using_shapelesss_sized_type_to_eliminate_real/">nice example</a> of using Scala’s
<code>Shapeless</code> library for preventing off-by-one errors in CSV processing
code. Here’s the same, short, example rephrased with LiquidHaskell.</p>
<!-- more -->
<pre><span class="hs-linenum">23: </span><span class="hs-keyword">module</span> <span class="hs-conid">CSV</span> <span class="hs-keyword">where</span>
<span class="hs-linenum">24: </span>
<span class="hs-linenum">25: </span><span class="hs-comment">-- | Using LiquidHaskell for CSV lists</span>
<span class="hs-linenum">26: </span><span class="hs-comment">-- c.f. <a href="http://www.reddit.com/r/scala/comments/1nhzi2/using_shapelesss_sized_type_to_eliminate_real/">http://www.reddit.com/r/scala/comments/1nhzi2/using_shapelesss_sized_type_to_eliminate_real/</a></span>
</pre>
<h2 id="the-type">The Type</h2>
<p>Suppose you wanted to represent <em>tables</em> as a list of comma-separated values.</p>
<p>For example, here’s a table listing the articles and prices at the coffee shop
I’m sitting in right now:</p>
<table border="1">
<tr>
<th>
Item
</th>
<th>
Price
</th>
</tr>
<tr>
<td>
Espresso
</td>
<td>
2.25
</td>
</tr>
<tr>
<td>
Macchiato
</td>
<td>
2.75
</td>
</tr>
<tr>
<td>
Cappucino
</td>
<td>
3.35
</td>
</tr>
<tr>
<td>
Americano
</td>
<td>
2.25
</td>
</tr>
</table>
<p>You might represent this with a simple Haskell data type:</p>
<pre><span class="hs-linenum">64: </span>
<span class="hs-linenum">65: </span><span class="hs-keyword">data</span> <span class="hs-conid">CSV</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Csv</span> <span class="hs-layout">{</span> <a class="annot" href="#"><span class="annottext">(CSV.CSV) -&gt; [[(GHC.Types.Char)]]</span><span class="hs-varid">headers</span></a> <span class="hs-keyglyph">::</span> <span class="hs-keyglyph">[</span><span class="hs-conid">String</span><span class="hs-keyglyph">]</span>
<span class="hs-linenum">66: </span>               <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">(CSV.CSV) -&gt; [[[(GHC.Types.Char)]]]</span><span class="hs-varid">rows</span></a>    <span class="hs-keyglyph">::</span> <span class="hs-keyglyph">[</span><span class="hs-keyglyph">[</span><span class="hs-conid">String</span><span class="hs-keyglyph">]</span><span class="hs-keyglyph">]</span>
<span class="hs-linenum">67: </span>               <span class="hs-layout">}</span>
</pre>
<p>and now, the above table is just:</p>
<pre><span class="hs-linenum">73: </span><a class="annot" href="#"><span class="annottext">(CSV.CSV)</span><span class="hs-definition">zumbarMenu</span></a> <span class="hs-keyglyph">=</span> <a class="annot" href="#"><span class="annottext">x1:[[(GHC.Types.Char)]]
-&gt; [{VV : [[(GHC.Types.Char)]] | ((len VV) == (len x1))}]
-&gt; (CSV.CSV)</span><span class="hs-conid">Csv</span></a> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a>  <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Item"</span></a>     <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Price"</span></a><span class="hs-keyglyph">]</span>
<span class="hs-linenum">74: </span>                 <span class="hs-keyglyph">[</span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Espresso"</span></a> <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"2.25"</span></a> <span class="hs-keyglyph">]</span>  
<span class="hs-linenum">75: </span>                 <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Macchiato"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"2.75"</span></a> <span class="hs-keyglyph">]</span>
<span class="hs-linenum">76: </span>                 <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Cappucino"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"3.35"</span></a> <span class="hs-keyglyph">]</span>
<span class="hs-linenum">77: </span>                 <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Americano"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"2.25"</span></a> <span class="hs-keyglyph">]</span>
<span class="hs-linenum">78: </span>                 <span class="hs-keyglyph">]</span>
</pre>
<h2 id="the-errors">The Errors</h2>
<p>Our <code>CSV</code> type supports tables with an arbitrary number of <code>headers</code> and
<code>rows</code> but of course, we’d like to ensure that each <code>row</code> has data for <em>each</em>
header, that is, we don’t end up with tables like this one</p>
<pre><span class="hs-linenum">89: </span><span class="hs-comment">-- Eeks, we missed the header name!</span>
<span class="hs-linenum">90: </span>
<span class="hs-linenum">91: </span><a class="annot" href="#"><span class="annottext">(CSV.CSV)</span><span class="hs-definition">csvBad1</span></a> <span class="hs-keyglyph">=</span> <a class="annot" href="#"><span class="annottext">x1:[[(GHC.Types.Char)]]
-&gt; [{VV : [[(GHC.Types.Char)]] | ((len VV) == (len x1))}]
-&gt; (CSV.CSV)</span><span class="hs-conid">Csv</span></a> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a>  <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Date"</span></a> <span class="hs-comment">{- ??? -}</span> <span class="hs-keyglyph">]</span> 
<span class="hs-linenum">92: </span>              <span class="hs-error"><span class="hs-keyglyph">[</span></span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt; 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Mon"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-str">"1"</span></a><span class="hs-keyglyph">]</span>
<span class="hs-linenum">93: </span>              <span class="hs-error"><span class="hs-layout">,</span></span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt; 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Tue"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-str">"2"</span></a><span class="hs-keyglyph">]</span>
<span class="hs-linenum">94: </span>              <span class="hs-error"><span class="hs-layout">,</span></span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt; 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Wed"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-str">"3"</span></a><span class="hs-keyglyph">]</span> 
<span class="hs-linenum">95: </span>              <span class="hs-error"><span class="hs-keyglyph">]</span></span>
<span class="hs-linenum">96: </span>
</pre>
<p>or this one,</p>
<pre><span class="hs-linenum">102: </span><span class="hs-comment">-- Blergh! we missed a column.</span>
<span class="hs-linenum">103: </span>
<span class="hs-linenum">104: </span><a class="annot" href="#"><span class="annottext">(CSV.CSV)</span><span class="hs-definition">csvBad2</span></a> <span class="hs-keyglyph">=</span> <a class="annot" href="#"><span class="annottext">x1:[[(GHC.Types.Char)]]
-&gt; [{VV : [[(GHC.Types.Char)]] | ((len VV) == (len x1))}]
-&gt; (CSV.CSV)</span><span class="hs-conid">Csv</span></a> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a>  <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Name"</span></a> <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Age"</span></a>  <span class="hs-keyglyph">]</span> 
<span class="hs-linenum">105: </span>              <span class="hs-error"><span class="hs-keyglyph">[</span></span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Alice"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"32"</span></a>   <span class="hs-keyglyph">]</span>
<span class="hs-linenum">106: </span>              <span class="hs-error"><span class="hs-layout">,</span></span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Bob"</span></a>  <span class="hs-comment">{- ??? -}</span><span class="hs-keyglyph">]</span>
<span class="hs-linenum">107: </span>              <span class="hs-error"><span class="hs-layout">,</span></span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Cris"</span></a> <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"29"</span></a>   <span class="hs-keyglyph">]</span> 
<span class="hs-linenum">108: </span>              <span class="hs-error"><span class="hs-keyglyph">]</span></span>
</pre>
<p>Alas, both the above are valid inhabitants of the Haskell <code>CSV</code> type, and
so, sneak past GHC.</p>
<h2 id="the-invariant">The Invariant</h2>
<p>Thus, we want to <em>refine</em> the <code>CSV</code> type to specify that the <em>number</em> of
elements in each row is <em>exactly</em> the same as the <em>number</em> of headers.</p>
<p>To do so, we merely write a refined data type definition:</p>
<pre><span class="hs-linenum">123: </span><span class="hs-keyword">{-@</span> <span class="hs-keyword">data</span> <span class="hs-conid">CSV</span> <span class="hs-keyglyph">=</span> <span class="hs-conid">Csv</span> <span class="hs-layout">{</span> <span class="hs-varid">headers</span> <span class="hs-keyglyph">::</span> <span class="hs-keyglyph">[</span><span class="hs-conid">String</span><span class="hs-keyglyph">]</span>
<span class="hs-linenum">124: </span>                   <span class="hs-layout">,</span> <span class="hs-varid">rows</span>    <span class="hs-keyglyph">::</span> <span class="hs-keyglyph">[</span><span class="hs-layout">{</span><span class="hs-varid">v</span><span class="hs-conop">:</span><span class="hs-keyglyph">[</span><span class="hs-conid">String</span><span class="hs-keyglyph">]</span> <span class="hs-keyglyph">|</span> <span class="hs-layout">(</span><span class="hs-varid">len</span> <span class="hs-varid">v</span><span class="hs-layout">)</span> <span class="hs-keyglyph">=</span> <span class="hs-layout">(</span><span class="hs-varid">len</span> <span class="hs-varid">headers</span><span class="hs-layout">)</span><span class="hs-layout">}</span><span class="hs-keyglyph">]</span>
<span class="hs-linenum">125: </span>                   <span class="hs-layout">}</span>
<span class="hs-linenum">126: </span>  <span class="hs-keyword">@-}</span>
</pre>
<p>Here <code>len</code> is a <em>measure</em> <a href="../../../../blog/2013/01/31/safely-catching-a-list-by-its-tail.lhs/">denoting the length of a list</a>.
Thus, <code>(len headers)</code> is the number of headers in the table, and the
refinement on the <code>rows</code> field states that <em>each</em> <code>row</code> is a list of <code>String</code>s,
with exactly the same number of elements as the number of <code>headers</code>.</p>
<p>We can now have our arbitrary-arity tables, but LiquidHaskell will
make sure that we don’t miss entries here or there.</p>
<pre><span class="hs-linenum">138: </span><span class="hs-comment">-- All is well! </span>
<span class="hs-linenum">139: </span>
<span class="hs-linenum">140: </span><a class="annot" href="#"><span class="annottext">(CSV.CSV)</span><span class="hs-definition">csvGood</span></a> <span class="hs-keyglyph">=</span> <a class="annot" href="#"><span class="annottext">x1:[[(GHC.Types.Char)]]
-&gt; [{VV : [[(GHC.Types.Char)]] | ((len VV) == (len x1))}]
-&gt; (CSV.CSV)</span><span class="hs-conid">Csv</span></a> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Id"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Name"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Days"</span></a><span class="hs-keyglyph">]</span>
<span class="hs-linenum">141: </span>              <span class="hs-keyglyph">[</span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-str">"1"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Jan"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"31"</span></a><span class="hs-keyglyph">]</span>
<span class="hs-linenum">142: </span>              <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-str">"2"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Feb"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"28"</span></a><span class="hs-keyglyph">]</span>
<span class="hs-linenum">143: </span>              <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-str">"3"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Mar"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"31"</span></a><span class="hs-keyglyph">]</span>
<span class="hs-linenum">144: </span>              <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-str">"4"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Apr"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"30"</span></a><span class="hs-keyglyph">]</span> 
<span class="hs-linenum">145: </span>              <span class="hs-keyglyph">]</span>
</pre>
<h2 id="bonus-points">Bonus Points</h2>
<p>How would you modify the specification to prevent table with degenerate entries
like this one?</p>
<pre><span class="hs-linenum">155: </span><a class="annot" href="#"><span class="annottext">(CSV.CSV)</span><span class="hs-definition">deg</span></a> <span class="hs-keyglyph">=</span> <a class="annot" href="#"><span class="annottext">x1:[[(GHC.Types.Char)]]
-&gt; [{VV : [[(GHC.Types.Char)]] | ((len VV) == (len x1))}]
-&gt; (CSV.CSV)</span><span class="hs-conid">Csv</span></a> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a>  <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Id"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Name"</span></a><span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Days"</span></a><span class="hs-keyglyph">]</span>
<span class="hs-linenum">156: </span>          <span class="hs-keyglyph">[</span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-str">"1"</span></a> <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Jan"</span></a> <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"31"</span></a><span class="hs-keyglyph">]</span>
<span class="hs-linenum">157: </span>          <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}]&lt;\_ VV -&gt; ((len VV) &gt;= 0)&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-keyglyph">[</span></a><a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; false) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-str">"2"</span></a> <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [(GHC.Types.Char)] | ((len VV) &gt;= 0)}</span><span class="hs-str">"Feb"</span></a> <span class="hs-layout">,</span> <a class="annot" href="#"><span class="annottext">{VV : [{VV : (GHC.Types.Char) | false}]&lt;\_ VV -&gt; false&gt; | (((null VV)) &lt;=&gt; true) &amp;&amp; ((len VV) == 0) &amp;&amp; ((len VV) &gt;= 0)}</span><span class="hs-str">""</span></a><span class="hs-keyglyph">]</span>
<span class="hs-linenum">158: </span>          <span class="hs-keyglyph">]</span>
</pre>
                <hr>
                <ul class="pager">
                    
                    
                </ul>

                <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    var disqus_config = function () {
        this.page.url        = 'https://ucsd-progsys.github.io/liquidhaskell-blog/2013/10/10/csv-tables.lhs';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '/2013/10/10/csv-tables.lhs';           // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');
        s.src = '//liquidhaskell.disqus.com/embed.js';  // IMPORTANT: Replace EXAMPLE with your forum shortname!
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


            </div>
        </div>
    </div>
</article>

        </div>
        <div id="footer">
        </div>
      <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="https://ucsd-progsys.github.io/liquidhaskell-blog/feed.xml" data-datatype="json" data-type="GET" data-target="#frame" class="reload" id="clickme">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/ranjitjhala" data-datatype="json" data-type="GET" data-target="#frame" class="reload" id="clickme" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://plus.google.com/u/0/106612421534244742464" data-datatype="json" data-type="GET" data-target="#frame" class="reload" id="clickme" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/ucsd-progsys" target="_blank">
                            <span class="fa-stack fa-lg">

                              <i class="fa fa-arrow-circle-o-down"></i>
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
		    
                </ul>
                <p class="copyright text-muted">
                
                  Copyright &copy; Ranjit Jhala 2016-17.
                
                  Generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>,
                  template by <a href="http://lucumr.pocoo.org">Armin Ronacher</a>,
                  suggest improvements <a href="https://github.com/ucsd-progsys/liquidhaskell-blog/">here</a>.
                </p>
            </div>
        </div>
    </div>
</footer>


<!-- jQuery -->
<script src="https://ucsd-progsys.github.io/liquidhaskell-blog/static/js/jquery.min.js"></script>
<script src="https://ucsd-progsys.github.io/liquidhaskell-blog/static/js/spaceg.stylesheets.min.js"></script>
<script src="https://ucsd-progsys.github.io/liquidhaskell-blog/static/js/bootstrap.min.js"></script>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
<script src="https://ucsd-progsys.github.io/liquidhaskell-blog/static/js/anim.js"></script>
<script src="https://ucsd-progsys.github.io/liquidhaskell-blog/static/js/scripts.js"></script>

    </body>
</html>
